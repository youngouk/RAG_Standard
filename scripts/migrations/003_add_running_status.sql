-- ============================================================================
-- 배치 실행 상태에 'running' 추가 마이그레이션
-- ============================================================================
-- 목적: batch_runs 테이블의 status CHECK 제약조건에 'running' 상태 추가
-- 작성일: 2025-11-19
-- 이슈: status="running" 삽입 시 CHECK 제약조건 위반 오류 발생
-- ============================================================================

-- ============================================================================
-- 1. 기존 CHECK 제약조건 삭제
-- ============================================================================
ALTER TABLE batch_runs
DROP CONSTRAINT IF EXISTS batch_runs_status_check;

-- ============================================================================
-- 2. 'running' 상태를 포함한 새 CHECK 제약조건 추가
-- ============================================================================
ALTER TABLE batch_runs
ADD CONSTRAINT batch_runs_status_check
    CHECK (status IN ('running', 'success', 'partial_failure', 'failure'));

-- ============================================================================
-- 완료 메시지
-- ============================================================================
DO $$
BEGIN
    RAISE NOTICE '✅ batch_runs.status CHECK 제약조건 업데이트 완료';
    RAISE NOTICE '   - 허용 상태: running, success, partial_failure, failure';
END $$;
